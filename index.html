<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Choice-ru | 選擇器</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,500,1,0..200" />
    <link rel="icon" href="https://raw.githubusercontent.com/Ruixue9626/choice-ru/refs/heads/main/%E7%84%A1%E6%A8%99%E9%A1%8C342_20260130190626.png" type="image/png">
    <style>
        :root {
            --bg-image: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.4);
            --glass-blur: blur(25px) saturate(180%);
            --nav-active-bg: linear-gradient(135deg, rgba(181, 151, 215, 0.6), rgba(244, 176, 227, 0.6));
            --text-main: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        body.dark-text-mode {
            --text-main: #333333;
            --text-secondary: rgba(0, 0, 0, 0.5);
            --shadow-color: rgba(255, 255, 255, 0.3);
            --glass-bg: rgba(255, 255, 255, 0.25);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0; height: 100vh;
            background: var(--bg-image); background-size: cover; background-position: center;
            font-family: -apple-system, "Noto Sans TC", sans-serif;
            color: var(--text-main); display: flex; flex-direction: column; align-items: center;
            overflow: hidden; transition: all 0.4s ease;
        }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 var(--shadow-color);
        }

        .content-container { flex: 1; width: 100%; position: relative; margin-bottom: 125px; }

        .page {
            position: absolute; inset: 0; padding: 25px;
            display: flex; flex-direction: column; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.4s ease;
        }
        .page.active { opacity: 1; pointer-events: auto; }

        #display-result {
            font-size: 4rem; font-weight: 900; height: 70%; display: flex; align-items: center;
            text-align: center; color: var(--text-main); text-shadow: 0 4px 15px var(--shadow-color);
        }

        /* --- 輸入框修正 --- */
        .input-bar {
            width: 100%; height: 68px; border-radius: 34px;
            padding: 0 10px 0 25px;
            display: flex; align-items: center; margin-bottom: 20px;
            overflow: visible; 
        }
        .input-bar input {
            flex: 1; background: transparent; border: none; color: var(--text-main); 
            font-size: 1.1rem; outline: none; min-width: 0;
        }

        .add-btn {
            background: rgba(255,255,255,0.25); color: var(--text-main); border: 1px solid var(--glass-border);
            width: 48px; height: 48px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; cursor: pointer; transition: 0.2s;
        }
        .add-btn:active { transform: scale(0.9); }

        .todo-item {
            border-radius: 22px; padding: 18px 25px; margin-bottom: 12px;
            display: flex; align-items: center; gap: 15px; color: var(--text-main);
        }

        /* --- 底部導航 --- */
        .bottom-nav-container {
            position: fixed; bottom: 30px; width: 100%;
            display: flex; justify-content: center; align-items: center;
            gap: 15px; padding: 0 20px; z-index: 90;
        }

        .nav-pill { display: flex; border-radius: 40px; padding: 6px; width: 260px; height: 72px; }
        .tab-btn {
            flex: 1; border: none; background: transparent; color: var(--text-secondary);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            gap: 2px; border-radius: 35px; font-weight: bold; font-size: 0.85rem; transition: 0.3s;
            position: relative; z-index: 1;
        }
        .tab-btn.active { color: var(--text-main); }
        .tab-btn.active::before {
            content: ''; position: absolute; inset: 4px; background: var(--nav-active-bg);
            border-radius: 30px; z-index: -1;
        }

        /* 設定按鈕：修復白邊過粗問題 */
        .settings-btn-circle {
            width: 72px; height: 72px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: var(--text-main); flex-shrink: 0;
            border: 1px solid rgba(255, 255, 255, 0.45); /* 恢復為細緻 1px */
        }
        .settings-btn-circle .material-symbols-rounded { font-size: 40px; }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(15px);
            display: none; justify-content: center; align-items: center; z-index: 100;
        }
        .modal { width: 90%; max-width: 400px; border-radius: 35px; padding: 25px; color: white; }
        textarea, .bg-input {
            width: 100%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            border-radius: 18px; color: white; padding: 15px; margin: 10px 0; outline: none; resize: none;
        }
        .sync-option {
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 20px; margin-bottom: 10px;
        }
        .save-btn {
            width: 100%; padding: 16px; border: none; background: white; color: #a18cd1 !important;
            border-radius: 50px; font-weight: 900; margin-top: 20px; font-size: 1.1rem;
        }
        .switch { position: relative; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background: rgba(255,255,255,0.2); transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background: #72efdd; }
        input:checked + .slider:before { transform: translateX(24px); }
    </style>
</head>
<body>
    <div class="content-container">
        <div id="page-picker" class="page active" onclick="startRoll()">
            <div id="display-result">TAP TO START</div>
            <div style="color:var(--text-secondary); font-size:0.8rem; letter-spacing: 2px;">/// 按下開始 ///</div>
        </div>
        <div id="page-calendar" class="page">
            <div style="width: 100%; height: 100%; display: flex; flex-direction: column;">
                <div class="input-bar glass-panel">
                    <input type="text" id="todoInput" placeholder="輸入新選項...">
                    <button class="add-btn" onclick="addTodo()">
                        <span class="material-symbols-rounded">add</span>
                    </button>
                </div>
                <div style="flex: 1; overflow-y: auto; padding: 5px;">
                    <ul id="todoList" style="list-style:none; padding:0; margin:0;"></ul>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-nav-container">
        <div class="nav-pill glass-panel">
            <button class="tab-btn active" id="tab-picker" onclick="switchTab('picker')">
                <span class="material-symbols-rounded">casino</span>選取器
            </button>
            <button class="tab-btn" id="tab-calendar" onclick="switchTab('calendar')">
                <span class="material-symbols-rounded">format_list_bulleted</span>清單
            </button>
        </div>
        <button class="settings-btn-circle glass-panel" onclick="toggleModal(true)">
            <span class="material-symbols-rounded">settings</span>
        </button>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal glass-panel">
            <h3 style="margin:0 0 20px 0; display: flex; align-items: center; gap: 10px;"><span class="material-symbols-rounded">settings</span> 設定</h3>
            <div class="sync-option"><span>深色字體模式</span><label class="switch"><input type="checkbox" id="darkTextToggle" onchange="applyDarkText()"><span class="slider"></span></label></div>
            <div class="sync-option"><span>同步清單</span><label class="switch"><input type="checkbox" id="syncToggle" onchange="handleSyncChange()"><span class="slider"></span></label></div>
            <p style="font-size: 0.8rem; margin: 10px 0 0 5px; opacity: 0.8;">手動選項內容</p>
            <textarea id="itemsInput" placeholder="每行輸入一個選項..."></textarea>
            <p style="font-size: 0.8rem; margin: 10px 0 0 5px; opacity: 0.8;">背景圖片網址 (URL)</p>
            <input type="text" id="bgInput" class="bg-input" placeholder="貼上網址...">
            <button class="save-btn" onclick="toggleModal(false)">儲存完成</button>
        </div>
    </div>

<script>
    let options = JSON.parse(localStorage.getItem('options')) || ["1", "2", "3"];
    let todos = JSON.parse(localStorage.getItem('todos')) || [];
    let bgUrl = localStorage.getItem('bgUrl') || '';
    let isSyncEnabled = JSON.parse(localStorage.getItem('isSyncEnabled')) || false;
    let isDarkText = JSON.parse(localStorage.getItem('isDarkText')) || false;
    let isRolling = false;

    window.onload = () => {
        document.getElementById('itemsInput').value = options.join('\n');
        document.getElementById('bgInput').value = bgUrl;
        document.getElementById('syncToggle').checked = isSyncEnabled;
        document.getElementById('darkTextToggle').checked = isDarkText;
        handleSyncChange();
        applyBg(bgUrl);
        applyDarkText();
        renderTodos();
    };

    function applyBg(url) { document.body.style.backgroundImage = (url && url.trim()) ? `url('${url}')` : "linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)"; }
    function applyDarkText() { isDarkText = document.getElementById('darkTextToggle').checked; document.body.classList.toggle('dark-text-mode', isDarkText); }
    function switchTab(tab) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('page-' + tab).classList.add('active');
        document.getElementById('tab-' + tab).classList.add('active');
    }
    function handleSyncChange() {
        isSyncEnabled = document.getElementById('syncToggle').checked;
        document.getElementById('itemsInput').disabled = isSyncEnabled;
        document.getElementById('itemsInput').style.opacity = isSyncEnabled ? "0.4" : "1";
        if (isSyncEnabled) syncOptionsFromTodos();
    }
    function syncOptionsFromTodos() {
        if (!isSyncEnabled) return;
        // 過濾 logic: 只抓取 done 為 false 的項目
        options = todos.filter(t => !t.done).map(t => t.text).filter(t => t.trim() !== "");
        document.getElementById('itemsInput').value = options.join('\n');
    }
    function toggleModal(show) {
        const overlay = document.getElementById('modalOverlay');
        overlay.style.display = show ? 'flex' : 'none';
        if (!show) {
            isSyncEnabled = document.getElementById('syncToggle').checked;
            if (!isSyncEnabled) options = document.getElementById('itemsInput').value.split('\n').filter(i => i.trim() !== "");
            bgUrl = document.getElementById('bgInput').value.trim();
            localStorage.setItem('options', JSON.stringify(options));
            localStorage.setItem('bgUrl', bgUrl);
            localStorage.setItem('isSyncEnabled', JSON.stringify(isSyncEnabled));
            localStorage.setItem('isDarkText', JSON.stringify(document.getElementById('darkTextToggle').checked));
            applyBg(bgUrl);
        }
    }
    function startRoll() {
        if (isRolling || options.length === 0) return;
        isRolling = true;
        let count = 0;
        const display = document.getElementById('display-result');
        const timer = setInterval(() => {
            display.innerText = options[Math.floor(Math.random() * options.length)];
            if (count++ > 15) { clearInterval(timer); isRolling = false; }
        }, 60);
    }
    function addTodo() {
        const input = document.getElementById('todoInput');
        if (!input.value.trim()) return;
        todos.push({ text: input.value, done: false });
        input.value = "";
        saveAndRender();
    }
    function toggleTodo(i) { todos[i].done = !todos[i].done; saveAndRender(); }
    function deleteTodo(i) { todos.splice(i, 1); saveAndRender(); }
    function saveAndRender() { 
        if (isSyncEnabled) syncOptionsFromTodos();
        localStorage.setItem('todos', JSON.stringify(todos)); 
        localStorage.setItem('options', JSON.stringify(options));
        renderTodos(); 
    }
    function renderTodos() {
        const list = document.getElementById('todoList');
        const sorted = [...todos].map((t, i) => ({...t, id: i})).sort((a, b) => a.done - b.done);
        list.innerHTML = sorted.map(t => `
            <li class="todo-item glass-panel" style="${t.done ? 'opacity: 0.6;' : ''}">
                <span class="material-symbols-rounded" onclick="toggleTodo(${t.id})">${t.done ? 'check_circle' : 'radio_button_unchecked'}</span>
                <span style="flex:1; ${t.done ? 'text-decoration:line-through;' : ''}" onclick="toggleTodo(${t.id})">${t.text}</span>
                <span class="material-symbols-rounded" style="opacity:0.3;" onclick="deleteTodo(${t.id})">close</span>
            </li>
        `).join('');
    }
</script>
</body>
</html>
